<?php

require_once 'PHPUnit/Extensions/OutputTestCase.php';
require_once 'PHPUnit/Framework.php';

require_once dirname(__FILE__) . '/../../Benchmark/Benchmark.php';

/**
 * Test class for GuiTemplate.
 * Generated by PHPUnit on 2010-08-28 at 23:23:01.
 */
class GuiTemplateTest extends PHPUnit_Extensions_OutputTestCase
{

    /**
     * Sets up the fixture, for example, opens a network connection.
     * This method is called before a test is executed.
     */
    protected function setUp()
    {

    }

    /**
     * Tears down the fixture, for example, closes a network connection.
     * This method is called after a test is executed.
     */
    protected function tearDown()
    {

    }

    public function testConstructor_InvalidTemplateFile()
    {
        try {
        new GuiTemplate('unknown_template');
        self::fail('TemplateNotFoundException expected');
        } catch ( TemplateNotFoundException $ex ) {

        }
    }

    public function testSetTemplate()
    {
        $tpl_name = 'hello_template.php';
        $template = $this->getValidUiTemplateInstance($tpl_name);
        $basename = pathinfo($template->getTemplate(), PATHINFO_DIRNAME);

        self::assertSame($basename . '/' . $tpl_name, $template->getTemplate());
    }

    /**
     * @todo Implement testAssign().
     */
    public function testAssign()
    {
        $template = $this->getValidUiTemplateInstance('hello_template.php');

        self::assertNull($template->data,
                        'variable was not assigned, there should not exist');

        $value = 'value';
        $template->assign('data', $value);

        self::assertSame($value, $template->data,
                        'variable should exist and contain assigned value');
    }

    public function testRender()
    {
        $template = $this->getValidUiTemplateInstance('hello_template.php');

        echo $template->render();

        $this->expectOutputString('hello');
    }

    public function testRender_TemplateNotSet()
    {
        $template = new GuiTemplate();
        self::assertFalse($template->render());
    }

    protected function getValidUiTemplateInstance($template)
    {
        return new GuiTemplateProxy($template);
    }

}

class GuiTemplateProxy extends GuiTemplate
{
    protected function getTemplateDir()
    {
        return dirname(__FILE__) . '/../Helper/';
    }

}
